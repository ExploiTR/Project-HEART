package hacks.exploitr.projectheart.ui;

import android.os.Bundle;
import android.view.View;

import androidx.appcompat.app.AppCompatActivity;

import java.util.ArrayList;
import java.util.List;

import hacks.exploitr.projectheart.R;
import hacks.exploitr.projectheart.databinding.ActivityProcessingBinding;
import hacks.exploitr.projectheart.tf.AI;

public class Processing extends AppCompatActivity {

	ArrayList<Integer> result = new ArrayList<>();
	int zero, one, two, three, four;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);

		View view = getLayoutInflater().inflate(R.layout.activity_processing, null);
		ActivityProcessingBinding binding = ActivityProcessingBinding.bind(view);
		setContentView(view);

		ArrayList<Integer> data = SecondFragment.saveQueue;
		if (data == null)
			return;
		else System.out.println(data);

		int firstIdx = data.indexOf(500);

		List<Integer> newData = data.subList(firstIdx, data.size());
		int totalSampleSize = (int) (newData.size() / 188f);

		for (int i = 0; i < totalSampleSize; i++) {
			List<Integer> yes = newData.subList(i * 188, (i * 188) + 187);
			AI.getInstance().getType(getBaseContext(), convertIntegers(yes), new AI.AnswerListener() {
				@Override
				public void output(int out) {
					result.add(out);
				}

				@Override
				public void onStart() {
				}

				@Override
				public void errorDes(String err) {

				}
			});
		}
		for (int res : result) {
			if (res == 0)
				zero++;
			else if (res == 1)
				one++;
			else if (res == 2)
				two++;
			else if (res == 3)
				three++;
			else
				four++;
		}
		binding.textView.setText(String.format(getString(R.string.normal_beats_0), (zero * 100) / totalSampleSize, totalSampleSize));
		binding.textView2.setText(String.format(getString(R.string.supraventrical_beats_1), (one * 100) / totalSampleSize, totalSampleSize));
		binding.textView3.setText(String.format(getString(R.string.ventricular_beats_2), (two * 100) / totalSampleSize, totalSampleSize));
		binding.textView4.setText(String.format(getString(R.string.fusion_beats_3), (three * 100) / totalSampleSize, totalSampleSize));
		binding.textView5.setText(String.format(getString(R.string.unknown_beats_4), (four * 100) / totalSampleSize, totalSampleSize));
	}

	public static int[] convertIntegers(List<Integer> integers) {
		int[] ret = new int[integers.size()];
		for (int i = 0; i < ret.length; i++) {
			ret[i] = integers.get(i);
		}
		return ret;
	}
}